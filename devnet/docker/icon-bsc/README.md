------------------------------------------------------------------------------------------------
KNOWN ISSUES: 
Running make buildimg on M1 MacOS can get stuck at gradle process. 
Current workaround: 
    1. Interrup the process and rerun. Completes after multiple retries. The issue is seen for Full Deployment (section 1.1) only
    2. Instead of Full Deployment, you can try Piecewise Deployment (Section 1.2). Here the gradle build is done on local PC.


Deployment Involves the following steps:
1. NODES:                  There should be icon and bsc nodes running (either as testnet/mainnet) or as local docker containers
2. BUILD_ARTIFACTS:        Build artifacts (jar & node_modules) need to be created
3. DEPLOY_SMART_CONTRACTS: Smart Contracts should be deployed on these icon and bsc nodes using build artifacts
4. RELAY_CONFIG:           After smart contract deployment completes, the deployment artifacts includes relay config bmr.config.json
5. RELAY_RUN:              Relay (also called bmr, iconbridge) should be run
6. USE_CASES:              Deployment artifacts include addresses.json, Use the contract addresses mentioned there for any use cases (e.g. token transfer)

------------------------------------------------------------------------------------------------
Alternatives To Deploying ICON_BRIDGE:
1. Deploy on PC
    1.1 Full Deployment        (Useful for newcomers. All the steps done inside a docker container. )
    1.2 Piecewise Deployment    (Useful for developers. Steps run on docker+PC)
2. Deploy on Mainnet/Testnet


1. Deploy on PC
    1.1 Full Deployment - Section 3
        make cleanimglocal        #Clean Previous build & deployment artifacts if present
        make buildimglocal        #Build BMR,BSC,ICON images
        make runimglocal          #Run containers. deploys smart contract, run relay
        Optional:
            make removeimglocal   #Cleans artifacts and also removes previously built images

    1.2 PieceWise Deployment
        #Install Dependencies on PC- Section 3
        make buildsc                    #Builds smart contracts
        make buildnodes                 #Build ICON & BSC nodes
        make runnodes                   #RUN ICON & BSC nodes locally
        make deploysclocalnet           #Deploy smart contracts on ICON & BSC nodes
        make runrelaysrc                #Run relay from source
            Optional:                   #Run relay from docker container instead of source
                make stoprelayimg       #Stop relay docker container (if present)
                make buildrelayimg      #Build relay docker image 
                make runrelayimg        #Run relay docker container
            Optional:
                make stopnodes          #Stop icon & bsc nodes
                make cleanartifacts     #Clean artifacts generated by smart contract deployment


2 Deploy on Mainnet/Testnet
    make buildsc                    #Builds smart contracts
    make deploysctesstnet           #Deploy smart contracts on Testnet. Using scripts/config.sh
    make runrelaysrc                #Run relay from source
        Optional:                   #Run relay from docker container instead of source
            make stoprelayimg       #Stop relay docker container (if present)
            make buildrelayimg      #Build relay docker image 
            make runrelayimg        #Run relay docker container
        Optional:
            make cleanartifacts     #Clean artifacts generated by smart contract deployment

------------------------------------------------------------------------------------------------
3. Dependencies:
The following must be installed on your PC to run Section 1.2 and Section 2
    - Docker
    - java 11 and gradle 6.7.1
    - goloop
    - NodeJS
    - Truffle  v5.5.5
    - EthKey 
    - Go >= 1.13 (ref: go.mod)


1.  ### Docker

    To build, publish, run blockchains (icon/hmny) locally or remote docker host. Download and install docker from https://docs.docker.com/engine/install/ubuntu/

    After installing, make sure that the user account used to run docker (_default is ubuntu_) is added to `docker` group.

        $ sudo groupadd docker
        $ sudo usermod -aG docker $USER
        $ newgrp docker

    Fully logout, and log back in to be able apply the changes.

2.  ### SdkMan

    To install gradle and java.

    1. _`fish`_

       https://github.com/reitzig/sdkman-for-fish

    2. _`bash`_

       https://sdkman.io/install

3.  ### Java and Gradle

    To build javascores.

    1. _`Java`_

       `sdk install java 11.0.11.hs-adpt`

    2. _`gradle`_

       `sdk install gradle 6.7.1`

4.  ### Goloop

    https://github.com/icon-project/goloop

    To interact with icon blockchain using RPC calls and generate keystores.

    `go install github.com/icon-project/goloop/cmd/goloop`

    If `go install` doesn't work use `go get` instead.

5.  ### NodeJS

    To build and deploy solidity smartcontracts.

    1. _`fish`_

       `nvm`: https://github.com/jorgebucaran/nvm.fish

       ```
       $ fisher install jorgebucaran/nvm.fish
       $ nvm install v15.12.0
       $ set --universal nvm_default_version v15.12.0
       $ nvm use v15.12.0
       $ node --version > ~/.nvmrc
       ```

    2. _`bash`_

       https://github.com/nvm-sh/nvm

       ```
       $ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
       $ nvm install v15.12.0
       $ nvm use v15.12.0
       $ node --version > ~/.nvmrc
       ```

6.  ### Truffle

    https://trufflesuite.com/docs/truffle/getting-started/installation.html

    `npm install -g truffle@5.5.5`

7.  ### Ethkey

    `go get github.com/ethereum/go-ethereum/cmd/ethkey`